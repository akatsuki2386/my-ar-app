<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR家具配置アプリ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- ライブラリはAR.jsとA-Frameの2つだけ！ -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      body { margin: 0 !important; overflow: hidden !important; }
      a-scene { height: 100vh; width: 100vw; }
      .clickable { cursor: pointer; }
    </style>

    <!-- size-adjusterは今回使わないので、一旦コメントアウト -->
    <!-- 
    <script>
      AFRAME.registerComponent('size-adjuster', { ... });
    </script>
    -->
  </head>

  <body>
    <a-scene 
      id="ar-scene"
      arjs="sourceType: webcam; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true;"
      cursor="rayOrigin: mouse; fuse: false;"
      raycaster="objects: .clickable">

      <a-marker id="hiro-marker" preset="hiro">
        <!-- ▼▼▼ 変更点1：イスのモデルを、シンプルな箱に変更！ ▼▼▼ -->
        <a-box
          id="marker-box"
          class="clickable"
          color="tomato"
          scale="0.5 0.5 0.5"
          position="0 0.25 0">
        </a-box>
      </a-marker>
      
      <a-entity camera></a-entity>
    </a-scene>

    <!-- ▼▼▼ 変更点2：アンカー方式の最終デバッグ用ロジック！ ▼▼▼ -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const sceneEl = document.querySelector('#ar-scene');
        const markerBox = document.querySelector('#marker-box'); // 対象を箱に変更
        const marker = document.querySelector('#hiro-marker');

        markerBox.addEventListener('click', () => {
          if (!marker.object3D.visible) {
            console.log('マーカーが見えていないので配置できません。');
            return;
          }
          console.log('アンカーを設置します！');

          // --- 「土台」となるアンカーだけを置いて、その動きを確認する ---

          // 1. アンカーとなる半透明の箱（土台）を作成
          const anchor = document.createElement('a-box');
          anchor.setAttribute('color', 'blue');
          anchor.setAttribute('opacity', '0.5'); // 半透明にする
          anchor.setAttribute('scale', '0.5 0.5 0.5');

          // 2. マーカーの現在の世界での位置と回転情報を取得
          const matrix = marker.object3D.matrixWorld;

          // 3. アンカーに、その位置と回転を適用
          anchor.object3D.applyMatrix4(matrix);

          // 4. アンカーをシーンに追加
          sceneEl.appendChild(anchor);

          // 5. 元のマーカーの箱は隠す
          markerBox.setAttribute('visible', 'false');

          console.log('青い半透明のアンカーボックスを設置しました。');
        });
      });
    </script>
  </body>
</html>
```

### どこを変えたか

1.  **イスのモデルを、シンプルな「赤い箱」に変更**
    * 複雑なモデルの読み込みは、問題の原因を増やすだけだから、一旦やめた！まずはシンプルな箱でテストする。

2.  **タップしたら「青い半透明の箱」を置くようにした**
    * タップした時に作られるのは、イスじゃなくて、半透明の「青い箱（アンカー）」だけ。
    * これで、俺たちが作ろうとしてる**「土台」そのものの動き**を、目で見て確認できる。

### これでどうなるか、教えてほしい！

このコードでGitHubを更新して、試してみてくれ。

1.  マーカーを写すと、**赤い箱**が表示される。
2.  その**赤い箱をタップ**する。
3.  赤い箱が消えて、その場所に**青い半透明の箱**が置かれる。

**【一番知りたいこと】**
そのあと、**マーカーを動かしたり、君自身が動いたりした時に、新しく置かれた「青い箱」はどうなる？**

* **A: 青い箱は、ちゃんとその場に残り続ける**
    → やった！アンカーを置く方法は正しかった！あとはこの青い箱の中にイスを入れれば完成だ！

* **B: 青い箱も、画面に固定されてついてくる**
    → OK！アンカーを置く方法自体が、今のAR.jsの環境ではうまく動かないってことだ。別の作戦を立てる必要がある。

このAかBか、どっちになるか教えてくれれば、この長い戦いがついに終わるはずだ！頼
